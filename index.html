<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Calculadora Forense - Ley de Newton</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    margin:0;
    min-height:100vh;
    background:linear-gradient(rgba(0,0,0,.65),rgba(0,0,0,.65)),
    url("https://balancemexico.com/wp-content/uploads/2023/10/img_3580-1.jpg")
    no-repeat center center fixed;
    background-size:cover;
    font-family:Arial;
    color:white;
    display:flex;
    justify-content:center;
    align-items:center;
}
.contenedor{
    background:rgba(31,42,56,.95);
    padding:25px;
    border-radius:14px;
    width:95%;
    max-width:450px;
}
label{margin-top:12px;display:block;font-weight:bold;}
input,button{
    width:100%;
    padding:8px;
    margin-top:5px;
    border-radius:6px;
    border:none;
}
button{
    background:#c0392b;
    color:white;
    font-size:16px;
    cursor:pointer;
}
button:hover{background:#e74c3c;}
.resultado{
    margin-top:20px;
    padding:15px;
    background:rgba(0,0,0,.35);
    display:none;
    border-left:4px solid #e74c3c;
}
canvas{
    background:white;
    border-radius:8px;
    margin-top:10px;
}
</style>
</head>

<body>
<div class="contenedor">
<h2>Calculadora Forense</h2>

<label for="T1">Temperatura corporal 1 (°C)</label>
<input type="number" id="T1">

<label for="T2">Temperatura corporal 2 (°C)</label>
<input type="number" id="T2">

<label for="dt">Tiempo entre mediciones (minutos)</label>
<input type="number" id="dt">

<label for="Ta">Temperatura ambiente (°C)</label>
<input type="number" id="Ta">

<label for="horaHallazgo">Hora en que se encontró el cuerpo</label>
<input type="time" id="horaHallazgo">

<button onclick="calcular()">Calcular</button>

<div class="resultado" id="resultado">
<p id="horaHall"></p>
<p id="tiempoMuerte"></p>
<p id="tiempoEntre"></p>
<p id="horaMuerte"></p>
<p id="texto"></p>
<canvas id="grafica"></canvas>
</div>
</div>

<script>
let chart;

function $(id){ return document.getElementById(id); }

function toNum(id){
  const v=parseFloat($(id).value);
  if(Number.isNaN(v)) throw new Error(`El campo ${id} es inválido`);
  return v;
}

function calcularHoraDeMuerte(horaHallazgo, minutos){
  const [h,m]=horaHallazgo.split(":").map(Number);
  let total=h*60+m-minutos;
  if(total<0) total+=1440;

  const hh=Math.floor(total/60);
  const mm=Math.round(total%60);
  const ampm=hh>=12?"PM":"AM";
  const h12=hh%12||12;

  return `${h12}:${mm.toString().padStart(2,"0")} ${ampm}`;
}

function calcular(){
  try{
    const T1=toNum("T1");
    const T2=toNum("T2");
    const dt=toNum("dt");
    const Ta=toNum("Ta");
    const horaHallazgo=$("horaHallazgo").value;
    const T0=37;

    if(!horaHallazgo) throw new Error("Ingresa la hora de hallazgo");

    // VALIDACIÓN FÍSICA
    if(!(T1 > T2 && T2 > Ta)){
      throw new Error("Debe cumplirse: T1 > T2 > Ta");
    }

    if(dt <= 0){
      throw new Error("El tiempo entre mediciones debe ser mayor a 0");
    }

    // LEY DE NEWTON
    const C = T1 - Ta;
    const ratio = (T2 - Ta) / C;
    const k = -(1/dt) * Math.log(ratio);

    if(k <= 0){
      throw new Error("Datos inconsistentes para el cálculo");
    }

    const tiempoDesdeMuerte =
      (1/k) * Math.log((T0 - Ta) / C); // MINUTOS

    // FORMATO DE TIEMPO
    let tiempoTexto="";
    if(tiempoDesdeMuerte < 60){
      tiempoTexto = `${tiempoDesdeMuerte.toFixed(0)} minutos`;
    }else{
      tiempoTexto = `${(tiempoDesdeMuerte/60).toFixed(2)} horas`;
    }

    horaHall.innerHTML=` <b>Hora de hallazgo:</b> ${horaHallazgo}`;
    tiempoMuerte.innerHTML=` <b>Tiempo desde la muerte:</b> ${tiempoTexto}`;
    tiempoEntre.innerHTML=` <b>Tiempo entre mediciones:</b> ${dt} minutos`;
    horaMuerte.innerHTML=` <b>Hora estimada de la muerte:</b> ${calcularHoraDeMuerte(horaHallazgo, tiempoDesdeMuerte)}`;

    texto.innerHTML=`El resultado se obtuvo aplicando estrictamente la Ley de Enfriamiento de Newton
    utilizando dos mediciones de temperatura corporal y la temperatura ambiente.`;

    dibujarGrafica(Ta, T0, k, tiempoDesdeMuerte);

    resultado.style.display="block";
  }catch(e){
    alert(e.message);
  }
}

function dibujarGrafica(Ta,T0,k,tiempo){
  let labels=[],data=[];
  for(let t=0;t<=tiempo+20;t+=5){
    labels.push((t/60).toFixed(2));
    data.push(Ta+(T0-Ta)*Math.exp(-k*t));
  }
  if(chart) chart.destroy();
  chart=new Chart(grafica,{
    type:"line",
    data:{
      labels,
      datasets:[{
        label:"Temperatura corporal (°C)",
        data,
        borderColor:"red",
        fill:false
      }]
    }
  });
}
</script>
</body>
</html>




